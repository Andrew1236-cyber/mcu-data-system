# –ü—Ä–æ—à–∏–≤–∫–∞ –¥–ª—è STM32 –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

## üìã –û–ø–∏—Å–∞–Ω–∏–µ
–ü—Ä–æ—à–∏–≤–∫–∞ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ STM32, —Ä–µ–∞–ª–∏–∑—É—é—â–∞—è –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –ø–æ Ethernet —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —É–∫–∞–∑–∞–Ω–Ω–æ–º –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º –∑–∞–¥–∞–Ω–∏–∏.

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è

### ‚úÖ –ß–∞—Å—Ç—å 1: –ü—Ä–æ—à–∏–≤–∫–∞ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ STM32Cube –∏ Ethernet
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏**: STM32Cube HAL, LwIP TCP/IP stack
- **Ethernet**: –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ —á–µ—Ä–µ–∑ Hardware Abstraction Layer (HAL)
- **LwIP**: Lightweight IP stack –¥–ª—è embedded —Å–∏—Å—Ç–µ–º

#### TCP/IP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```c
// –°–æ–∑–¥–∞–Ω–∏–µ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
tcp_pcb_ptr = tcp_new();
IP4_ADDR(&target_ip, 192, 168, 1, 100);
tcp_connect(tcp_pcb_ptr, &target_ip, SERVER_PORT, NULL);
–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
c
// –§–æ—Ä–º–∞—Ç: —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:–¥–∞–Ω–Ω—ã–µ:–≤—Ä–µ–º–µ–Ω–Ω–∞—è_–º–µ—Ç–∫–∞
snprintf(buffer, sizeof(buffer), "%s:%.1f:%lu", DEVICE_ID, temp_val, time_val);
// –ü—Ä–∏–º–µ—Ä: "STM32_001:25.5:123456789"
üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏ STM32
ETH: Ethernet controller

TIM2: –¢–∞–π–º–µ—Ä –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö

NVIC: –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∞–π–º–µ—Ä–∞

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏
c
#define SERVER_IP "192.168.1.100"  // IP —Å–µ—Ä–≤–µ—Ä–∞
#define SERVER_PORT 8080           // –ü–æ—Ä—Ç TCP —Å–µ—Ä–≤–µ—Ä–∞
#define DEVICE_ID "STM32_001"      // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏
–ò–Ω—Ç–µ—Ä–≤–∞–ª: 5000 –º—Å (5 —Å–µ–∫—É–Ω–¥)

–ú–µ—Ç–æ–¥: –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ TIM2

–§—É–Ω–∫—Ü–∏—è: HAL_TIM_PeriodElapsedCallback()

üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
STM32 —Å Ethernet (STM32F407, STM32F767, etc.)

STM32CubeIDE –≤–µ—Ä—Å–∏–∏ 1.8.0+

LwIP middleware

Ethernet –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ STM32CubeIDE
–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

File ‚Üí New ‚Üí STM32 Project

–í—ã–±—Ä–∞—Ç—å target MCU (–Ω–∞–ø—Ä–∏–º–µ—Ä, STM32F407VG)

Project name: "STM32_Data_Sender"

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∏–Ω–æ–≤

–í–∫–ª–∞–¥–∫–∞ "Pinout & Configuration"

–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å "ETH"

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–∏–Ω–æ–≤ ETH

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Middleware

–í–∫–ª–∞–¥–∫–∞ "Middleware"

–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å "LWIP"

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–ª–∏:

DHCP: Enabled

IP Address: 192.168.1.177

Netmask: 255.255.255.0

Gateway: 192.168.1.1

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–µ—Ä–∞

–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å "TIM2"

Prescaler: 8399

Counter Period: 4999

NVIC Settings: Enable TIM2 global interrupt

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ main.c –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏

–í main() –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–π–º–µ—Ä–∞

–í stm32f4xx_it.c –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã
–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
–ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–∞–∫–µ—Ç –¥–∞–Ω–Ω—ã—Ö

–§–æ—Ä–º–∞—Ç: "STM32_001:TEMP_25.5:123456789"

TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

–î–∞–Ω–Ω—ã–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è Python —Å–µ—Ä–≤–µ—Ä–æ–º –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º IP

–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: STM32_001 (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–¥–∞–Ω–∏—é)

–î–∞–Ω–Ω—ã–µ: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è 25.0-35.0

–í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞: –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã MCU –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

–ü—Ä–æ—Ç–æ–∫–æ–ª: TCP (–Ω–∞–¥–µ–∂–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞)

‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
–î–ª—è VS Code
–ö—Ä–∞—Å–Ω—ã–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –≤ VS Code - –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —è–≤–ª–µ–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ STM32Cube –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Å—Ä–µ–¥–µ STM32CubeIDE. –ö–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–µ–Ω –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –≤ —Ü–µ–ª–µ–≤–æ–π —Å—Ä–µ–¥–µ.

–°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

–£–∑–Ω–∞—Ç—å IP –∞–¥—Ä–µ—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º (ipconfig)

–ó–∞–º–µ–Ω–∏—Ç—å SERVER_IP –≤ –∫–æ–¥–µ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ—Ä—Ç 8080 –¥–æ—Å—Ç—É–ø–µ–Ω

–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
STM32 —Å Ethernet PHY

Ethernet –∫–∞–±–µ–ª—å

–°–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—Ä–æ—É—Ç–µ—Ä/–∫–æ–º–º—É—Ç–∞—Ç–æ—Ä)

ST-Link –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è

‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ STM32Cube –±–∏–±–ª–∏–æ—Ç–µ–∫

TCP/IP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Ethernet

–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö: —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:–¥–∞–Ω–Ω—ã–µ:–≤—Ä–µ–º–µ–Ω–Ω–∞—è_–º–µ—Ç–∫–∞

–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–ü—Ä–æ—à–∏–≤–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Å–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∑–∞–¥–∞–Ω–∏—è –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ —Ü–µ–ª–µ–≤–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏.